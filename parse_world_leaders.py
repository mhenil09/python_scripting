import urllib.request
import datetime
import schedule
today = str(datetime.date.today())
country_dict = {'Luxembourg': 'https://www.cia.gov/page-data/resources/government/luxembourg/page-data.json', 'Madagascar': 'https://www.cia.gov/page-data/resources/government/madagascar/page-data.json', 'Malawi': 'https://www.cia.gov/page-data/resources/government/malawi/page-data.json', 'Malaysia': 'https://www.cia.gov/page-data/resources/government/malaysia/page-data.json', 'Maldives': 'https://www.cia.gov/page-data/resources/government/maldives/page-data.json', 'Mali': 'https://www.cia.gov/page-data/resources/government/mali/page-data.json', 'Malta': 'https://www.cia.gov/page-data/resources/government/malta/page-data.json', 'Marshall Islands': 'https://www.cia.gov/page-data/resources/government/marshall-islands/page-data.json', 'Mauritania': 'https://www.cia.gov/page-data/resources/government/mauritania/page-data.json', 'Mauritius': 'https://www.cia.gov/page-data/resources/government/mauritius/page-data.json', 'Mexico': 'https://www.cia.gov/page-data/resources/government/mexico/page-data.json', 'Micronesia, Federated States of': 'https://www.cia.gov/page-data/resources/government/micronesia-federated-states-of/page-data.json', 'Moldova': 'https://www.cia.gov/page-data/resources/government/moldova/page-data.json', 'Monaco': 'https://www.cia.gov/page-data/resources/government/monaco/page-data.json', 'Mongolia': 'https://www.cia.gov/page-data/resources/government/mongolia/page-data.json', 'Montenegro': 'https://www.cia.gov/page-data/resources/government/montenegro/page-data.json', 'Morocco': 'https://www.cia.gov/page-data/resources/government/morocco/page-data.json', 'Mozambique': 'https://www.cia.gov/page-data/resources/government/mozambique/page-data.json', 'Namibia': 'https://www.cia.gov/page-data/resources/government/namibia/page-data.json', 'Nauru': 'https://www.cia.gov/page-data/resources/government/nauru/page-data.json', 'Nepal': 'https://www.cia.gov/page-data/resources/government/nepal/page-data.json', 'Netherlands': 'https://www.cia.gov/page-data/resources/government/netherlands/page-data.json', 'New Zealand': 'https://www.cia.gov/page-data/resources/government/new-zealand/page-data.json', 'Nicaragua': 'https://www.cia.gov/page-data/resources/government/nicaragua/page-data.json', 'Niger': 'https://www.cia.gov/page-data/resources/government/niger/page-data.json', 'Nigeria': 'https://www.cia.gov/page-data/resources/government/nigeria/page-data.json', 'Niue': 'https://www.cia.gov/page-data/resources/government/niue/page-data.json', 'North Macedonia': 'https://www.cia.gov/page-data/resources/government/north-macedonia/page-data.json', 'Norway': 'https://www.cia.gov/page-data/resources/government/norway/page-data.json', 'Oman': 'https://www.cia.gov/page-data/resources/government/oman/page-data.json', 'Pakistan': 'https://www.cia.gov/page-data/resources/government/pakistan/page-data.json', 'Palau': 'https://www.cia.gov/page-data/resources/government/palau/page-data.json', 'Panama': 'https://www.cia.gov/page-data/resources/government/panama/page-data.json', 'Papua New Guinea': 'https://www.cia.gov/page-data/resources/government/papua-new-guinea/page-data.json', 'Paraguay': 'https://www.cia.gov/page-data/resources/government/paraguay/page-data.json', 'Peru': 'https://www.cia.gov/page-data/resources/government/peru/page-data.json', 'Philippines': 'https://www.cia.gov/page-data/resources/government/philippines/page-data.json', 'Poland': 'https://www.cia.gov/page-data/resources/government/poland/page-data.json', 'Portugal': 'https://www.cia.gov/page-data/resources/government/portugal/page-data.json', 'Qatar': 'https://www.cia.gov/page-data/resources/government/qatar/page-data.json', 'Romania': 'https://www.cia.gov/page-data/resources/government/romania/page-data.json', 'Russia': 'https://www.cia.gov/page-data/resources/government/russia/page-data.json', 'Rwanda': 'https://www.cia.gov/page-data/resources/government/rwanda/page-data.json'} #, 'Saint Kitts and Nevis': 'https://www.cia.gov/page-data/resources/government/saint-kitts-and-nevis/page-data.json', 'Saint Lucia': 'https://www.cia.gov/page-data/resources/government/saint-lucia/page-data.json', 'Saint Vincent and the Grenadines': 'https://www.cia.gov/page-data/resources/government/saint-vincent-and-the-grenadines/page-data.json', 'Samoa': 'https://www.cia.gov/page-data/resources/government/samoa/page-data.json', 'San Marino': 'https://www.cia.gov/page-data/resources/government/san-marino/page-data.json', 'Sao Tome and Principe': 'https://www.cia.gov/page-data/resources/government/sao-tome-and-principe/page-data.json', 'Saudi Arabia': 'https://www.cia.gov/page-data/resources/government/saudi-arabia/page-data.json', 'Senegal': 'https://www.cia.gov/page-data/resources/government/senegal/page-data.json', 'Serbia': 'https://www.cia.gov/page-data/resources/government/serbia/page-data.json', 'Seychelles': 'https://www.cia.gov/page-data/resources/government/seychelles/page-data.json', 'Sierra Leone': 'https://www.cia.gov/page-data/resources/government/sierra-leone/page-data.json', 'Singapore': 'https://www.cia.gov/page-data/resources/government/singapore/page-data.json', 'Slovakia': 'https://www.cia.gov/page-data/resources/government/slovakia/page-data.json', 'Slovenia': 'https://www.cia.gov/page-data/resources/government/slovenia/page-data.json', 'Solomon Islands': 'https://www.cia.gov/page-data/resources/government/solomon-islands/page-data.json', 'Somalia': 'https://www.cia.gov/page-data/resources/government/somalia/page-data.json', 'South Africa': 'https://www.cia.gov/page-data/resources/government/south-africa/page-data.json', 'South Sudan': 'https://www.cia.gov/page-data/resources/government/south-sudan/page-data.json', 'Spain': 'https://www.cia.gov/page-data/resources/government/spain/page-data.json', 'Sri Lanka': 'https://www.cia.gov/page-data/resources/government/sri-lanka/page-data.json', 'Sudan': 'https://www.cia.gov/page-data/resources/government/sudan/page-data.json', 'Suriname': 'https://www.cia.gov/page-data/resources/government/suriname/page-data.json', 'Sweden': 'https://www.cia.gov/page-data/resources/government/sweden/page-data.json', 'Switzerland': 'https://www.cia.gov/page-data/resources/government/switzerland/page-data.json', 'Syria': 'https://www.cia.gov/page-data/resources/government/syria/page-data.json', 'Taiwan': 'https://www.cia.gov/page-data/resources/government/taiwan/page-data.json', 'Tajikistan': 'https://www.cia.gov/page-data/resources/government/tajikistan/page-data.json', 'Tanzania': 'https://www.cia.gov/page-data/resources/government/tanzania/page-data.json', 'Thailand': 'https://www.cia.gov/page-data/resources/government/thailand/page-data.json', 'Timor-Leste': 'https://www.cia.gov/page-data/resources/government/timor-leste/page-data.json', 'Togo': 'https://www.cia.gov/page-data/resources/government/togo/page-data.json', 'Tonga': 'https://www.cia.gov/page-data/resources/government/tonga/page-data.json', 'Trinidad and Tobago': 'https://www.cia.gov/page-data/resources/government/trinidad-and-tobago/page-data.json', 'Tunisia': 'https://www.cia.gov/page-data/resources/government/tunisia/page-data.json', 'Turkey': 'https://www.cia.gov/page-data/resources/government/turkey/page-data.json', 'Turkmenistan': 'https://www.cia.gov/page-data/resources/government/turkmenistan/page-data.json', 'Tuvalu': 'https://www.cia.gov/page-data/resources/government/tuvalu/page-data.json', 'Uganda': 'https://www.cia.gov/page-data/resources/government/uganda/page-data.json', 'Ukraine': 'https://www.cia.gov/page-data/resources/government/ukraine/page-data.json', 'United Arab Emirates': 'https://www.cia.gov/page-data/resources/government/united-arab-emirates/page-data.json', 'United Kingdom': 'https://www.cia.gov/page-data/resources/government/united-kingdom/page-data.json', 'Uruguay': 'https://www.cia.gov/page-data/resources/government/uruguay/page-data.json', 'Uzbekistan': 'https://www.cia.gov/page-data/resources/government/uzbekistan/page-data.json', 'Vanuatu': 'https://www.cia.gov/page-data/resources/government/vanuatu/page-data.json', 'Venezuela': 'https://www.cia.gov/page-data/resources/government/venezuela/page-data.json', 'Vietnam': 'https://www.cia.gov/page-data/resources/government/vietnam/page-data.json', 'Yemen': 'https://www.cia.gov/page-data/resources/government/yemen/page-data.json', 'Zambia': 'https://www.cia.gov/page-data/resources/government/zambia/page-data.json', 'Zimbabwe': 'https://www.cia.gov/page-data/resources/government/zimbabwe/page-data.json'}
file_name_prefix = "json_files/world_leaders/"
file_name_suffix = "_" + today + ".json"


def clean_string(text):
    return text.replace("<h3>", "").replace("</h3>", "").replace("&#038;", "&").replace("&amp;", "&").replace("&#8217;", "")


# call the URL & collect response
def fetch_data_from_url(url):
    file = urllib.request.urlopen(url)
    data = file.read()
    file.close()
    return str(data, "UTF-8")


def store_json_file(country_name, json_url):
    file_name = file_name_prefix + country_name + file_name_suffix
    f = open(file_name, "w")
    f.write(fetch_data_from_url(json_url))
    f.close()


def job():
    if len(list(country_dict.keys())) > 0:
        key = list(country_dict.keys())[0]
        print("Collecting data for " + key)
        store_json_file(clean_string(key), country_dict[key])
        del country_dict[key]
    else:
        exit(0)


schedule.every(10).minutes.do(job)


while True:
    schedule.run_pending()
